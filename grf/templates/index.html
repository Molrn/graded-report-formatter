{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'grf/css/styles.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="{% static 'grf/js/json-report.js' %}" defer></script>
<script src="{% static 'grf/js/report-import.js' %}" defer></script>

<div class="toolbar">
    <a href="/grf">Home</a>
    <div class="buttons">
        <button id="create-report">Create report</button>
        <input type="file" id="import-file-selector" accept=".json" style="display: none" multiple="false">
        <button id="json-import-button">Import report</button>
    </div>
</div>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Modification</th>
            <th>Creation</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>      
        {% for report in all_reports|dictsortreversed:"updated_at" %}
            <tr>
                <td><a href="{% url 'report' id=report.id %}">{{ report.title }}</a></td>
                <td>{{ report.updated_at }}</td>
                <td>{{ report.created_at }}</td>
                <td>
                    <button class="delete delete-report-button" data-report-id="{{ report.id }}" onclick="deleteReport(this)">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    function deleteReport(button) {
        const reportId = button.getAttribute('data-report-id');
        fetch(`/grf/delete_report/${reportId}/`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            setTimeout(function() { location.reload(); }, 1000);
        })
        .catch(error => { console.error(error); });
    }
</script>
